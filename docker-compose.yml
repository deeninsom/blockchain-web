version: "3.8"

services:
  # ============================
  # PostgreSQL Database
  # ============================
  db:
    image: postgres:15-alpine
    container_name: postgres_db
    restart: unless-stopped
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: nextjs_db
    volumes:
      - postgres_data:/var/lib/postgresql/data

  # ============================
  # IPFS (Kubo / go-ipfs)
  # ============================
  ipfs:
    image: ipfs/kubo:latest
    container_name: ipfs_node
    restart: unless-stopped
    ports:
      - "4001:4001"   # Swarm
      - "5001:5001"   # API (upload)
      - "8080:8080"   # Gateway (access)
    volumes:
      - ipfs_staging:/export
      - ipfs_data:/data/ipfs
    environment:
      IPFS_PROFILE: server
    command: [
      "daemon",
      "--enable-gc",
      "--migrate=true"
    ]

volumes:
  postgres_data:
  ipfs_staging:
  ipfs_data:
